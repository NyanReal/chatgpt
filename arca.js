javascript:(async()=>{const s=u=>new Promise((r,j)=>{const d=document.createElement('script');d.src=u;d.onload=()=>r();d.onerror=()=>j(new Error('failed:'+u));document.head.appendChild(d)});window.JSZip||await s('https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js');const T=(document.querySelector('meta[property="og:title"]')?.content||document.title||'post').trim(),U=location.href.split('#')[0],A=(document.querySelector('[rel="author"]')?.textContent||document.querySelector('.article-header .user, .user-info .nick, .writer, .author')?.textContent||document.querySelector('meta[name="author"]')?.content||'').trim(),D=(document.querySelector('time[datetime]')?.getAttribute('datetime')||document.querySelector('time')?.textContent||document.querySelector('.date, .time, .article-info time')?.textContent||'').trim(),SEL=['#article-content','.article-content','.content .fr-view','.fr-view','.article-body','.content-body','article .content','.markdown-body','.article .content-body'];let b=null;for(const q of SEL){const e=document.querySelector(q);if(e&&e.offsetHeight>0){b=e;break}}if(!b){alert('본문을 찾지 못했어요.');return}const c=b.cloneNode(true);c.querySelectorAll('script,style,iframe,video,audio,noscript').forEach(n=>n.remove());c.querySelectorAll('.btn,.buttons,.actions,.toolbar,.comment,.comments,.ad,[data-ad]').forEach(n=>n.remove());const imgs=[...c.querySelectorAll('img')].filter(i=>i.getAttribute('src')||i.getAttribute('data-src'));imgs.forEach(i=>{!i.getAttribute('src')&&i.getAttribute('data-src')&&i.setAttribute('src',i.getAttribute('data-src'))});const z=new JSZip(),dir=z.folder('images');let i=1,dl=[];const abs=s=>{try{return new URL(s,document.baseURI).href}catch{return s}};const fetchAB=async src=>{try{const r=await fetch(src,{credentials:'include'});if(!r.ok)throw new Error('HTTP '+r.status);return await (await r.blob()).arrayBuffer()}catch(e){try{const u=new URL(src,document.baseURI);if(u.hostname.endsWith('namu.la')){const prox='https://images.weserv.nl/?url='+encodeURIComponent(u.hostname+u.pathname+u.search);const r2=await fetch(prox,{credentials:'omit'});if(!r2.ok)throw new Error('HTTP '+r2.status);return await (await r2.blob()).arrayBuffer()}throw e}catch(e2){throw e2}}};for(const im of imgs){const src=abs(im.getAttribute('src'));let ext='png';try{const u=new URL(src,document.baseURI);const g=(u.pathname.split('.').pop()||'png').split(/[?#]/)[0].toLowerCase();ext=/^(png|jpg|jpeg|gif|webp|avif|bmp|svg)$/.test(g)?g:'png'}catch{}const name=`img_${String(i).padStart(3,'0')}.${ext}`;try{const ab=await fetchAB(src);im.setAttribute('src',`images/${name}`);im.removeAttribute('srcset');im.removeAttribute('data-src');im.removeAttribute('loading');dir.file(name,ab);dl.push(name);i++}catch(e){console.warn('IMG fail',src,e)}}const esc=s=>s.replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));const head=`<header style="font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,Apple SD Gothic Neo,Noto Sans KR,sans-serif;border-bottom:1px solid #ddd;padding:12px 0;margin-bottom:16px;"><div><strong>제목</strong>: ${esc(T)}</div><div><strong>작성일</strong>: ${esc(D||'Unknown')}</div><div><strong>작성자</strong>: ${esc(A||'Unknown')}</div><div><strong>원문 링크</strong>: <a href="${esc(U)}">${esc(U)}</a></div></header>`;const html=`<!doctype html><html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${esc(T)}</title><style>body{max-width:960px;margin:0 auto;padding:24px;font:16px/1.7 system-ui,-apple-system,Segoe UI,Roboto,Arial,Apple SD Gothic Neo,Noto Sans KR,sans-serif;color:#111;background:#fff}img{max-width:100%;height:auto}pre,code{white-space:pre-wrap;word-break:break-word}table{border-collapse:collapse}td,th{border:1px solid #ddd;padding:6px}</style></head><body>${head}<main>${c.innerHTML}</main></body></html>`;z.file('post.html',html);z.file('meta.txt',[`Title: ${T}`,`Author: ${A||'Unknown'}`,`Date: ${D||'Unknown'}`,`Source: ${U}`,dl.length?`Images: ${dl.length} files under /images`:`Images: (embedded URLs left if blocked)`].join('\n'));const name=`arca-${(T||'post').replace(/[\\/:*?"<>|]+/g,' ').trim().replace(/\s+/g,'-').slice(0,80)||'post'}.zip`;const B=await z.generateAsync({type:'blob'});const a=document.createElement('a');a.href=URL.createObjectURL(B);a.download=name;document.body.appendChild(a);a.click();setTimeout(()=>{URL.revokeObjectURL(a.href);a.remove()},1e3);})();