# Codex 사용 가이드라인 (UE5.5 TPS)

## 1) 목표
- **지금 당장 필요한 것만** 빠르게 만들고 검증한다.
- 과잉 설계/불필요한 산출물을 **초기에 차단**한다.
- Codex는 **구현 보조자**, 나는 **리뷰어/품질 책임자**.

---

## 2) 기본 원칙 (Rule of 7)
1. **작게 쪼개기**: 한 요청은 15~30분 내 검증 가능한 단위로.
2. **한 문장 목표**: “이번 요청으로 *무엇이 가능한가*”를 한 문장으로 명시.
3. **금지어**: “나중에 쓸지도”, “확장성 위해 미리”… ⇒ 전부 보류.
4. **스펙→테스트→코드**: 먼저 수용기준(DoD)→간단 테스트→구현.
5. **컨텍스트 절식**: 프롬프트는 *필요 정보만* (파일경로, API, DoD).
6. **세션 초기화**: 다른 작업으로 넘어갈 때는 새 세션에서 시작.
7. **리뷰 우선**: 결과를 붙여넣기 전 최소 2분 코드리뷰(자기검수 체크리스트).

---

## 3) 작업 루프 (15–30분 타임박스)

1) **스펙 스냅샷 작성 (2분)**  
2) **Codex 요청 (10–15분)**  
3) **자기검수 (2–5분)**  
4) **단기 테스트 (3–5분)**  
5) **커밋 & 메모 (2분)**  

---

## 4) Codex 요청 템플릿

```text
[목표] UMG로 미니맵 위젯을 화면 우상단에 표시하고, M키로 토글.

[현재 컨텍스트]
- 엔진: UE 5.5, C++/BP 혼합
- 게임모듈: ProjectTPS
- 입력 매핑: Enhanced Input 사용, M키 비할당 상태
- 작업 디렉터리 외 변경 금지: /Source/ProjectTPS/, /Content/UI/

[완료 조건(DoD)]
- PIE에서 시작 시 미니맵 위젯이 우상단에 표시
- M키로 표시/숨김 토글 가능
- 기존 위젯/입력 매핑 삭제/이름변경 금지
- 새 파일 명: `WBP_Minimap`, `MinimapSubsystem` (없으면 생성)

[산출물]
- 필요한 .h/.cpp, .uasset 생성/수정 목록
- 붙여넣기 가능한 코드 블록
- 적용/빌드/테스트 순서 번호 목록

[안전장치]
- 기존 파일 내용 삭제 금지
- 엔진/플러그인 설정 변경 금지
- 대안이 생기면 질문 대신 보수적 선택

[출력 형식]
1) 변경 파일 경로와 목적
2) 코드
3) 설치/빌드/테스트 절차(번호)
4) 예상 실패 포인트 & 롤백 방법
```

---

## 5) 자기검수 체크리스트

- [ ] **DoD와 1:1 일치**
- [ ] **변경 범위 준수**
- [ ] **기존 자산 보존**
- [ ] **에러 처리 최소화**
- [ ] **컴파일 가능성 확보**
- [ ] **의존성 폭주 없음**
- [ ] **주석에 운영 조건 명시**

---

## 6) 과잉 설계 방지 장치

### 금지 패턴
- “혹시 몰라서”로 추상 베이스 클래스 생성
- “미래 네트워킹 대비”로 리플리케이션 선반영
- 데이터구조 일반화/제너릭화 미리 적용
- 종속 플러그인 도입 선해결

### 허용 패턴
- 현재 시나리오 딱 하나 동작하게 만들기
- 명시적 스코프 좁히기
- 실험 디렉터리 `/Proto/<날짜_기능명>/`로 분리

---

## 7) Definition of Done(DoD) 예시

**UI 위젯**  
- 표시/비표시, 위치, 입력 토글, GC 누수 없음

**입력 액션**  
- Enhanced Input에 키 바인딩 추가
- 중복 바인딩/기존 입력 충돌 없음

**애니메이션 이벤트**  
- 특정 프레임에서 사운드/이펙트 발동
- 전이 규칙 변경 없이 기존 스테이트머신 유지

---

## 8) 저장소 운영 규칙

**브랜치 전략**
- `main`: 안정/데모
- `dev`: 통합
- `feat/<기능명>-<날짜>`: 기능 단위

**PR 템플릿**
```markdown
## 목적
## 변경 요약
## 테스트 방법
## 체크리스트
- [ ] DoD 충족
- [ ] 허용 경로만 변경
- [ ] 기존 자산 보존
```

**커밋 메시지 예시**
```
feat(ui): add minimap widget with M key toggle
한글: 미니맵 위젯 추가 및 M키 토글
```

---

## 9) UE5 작업별 미니 프롬프트 샘플

**입력 바인딩 추가**
```text
목표: Enhanced Input에 'ToggleMinimap' 액션 생성, 키 M 바인딩.
```

**위젯 스폰**
```text
목표: BeginPlay에 WBP_Minimap를 Viewport 우상단에 Add.
```

**애님 노티파이**
```text
목표: 재장전 모션 12f에서 사운드 Notify.
```

---

## 10) 실패/롤백 규칙

- 변경 파일 목록 확인 후 적용  
- 예상 실패 시나리오 3개 이상 요구  
- 롤백: 변경 파일만 복구 후 재시도

---

## 11) 세션 운영

- 작업 전 요약 컨텍스트 5줄 이내로 작성
- 다른 주제로 전환 시 세션 초기화
- “의견/대안 제시”는 허용하되, 실행은 규칙 내에서만

---

## 12) 빠른 판별 체크 (레드 플래그)
- “아키텍처”, “일반화”, “리팩터링 광범위” 단어 등장 → 거절
- 새 매니저/서브시스템 제안 → 근거 없으면 보류
- 파일 삭제/이름변경 제안 → 명시 없으면 금지

---

## 13) 미니 폼들

**작업 스냅샷 폼**
```
[이번 목표]
[DoD]
[변경 허용 경로]
[테스트]
```

**Codex 출력 요구 폼**
```
1) 변경 파일 경로와 목적
2) 전체 코드
3) 적용/빌드/테스트 절차
4) 실패 포인트 & 롤백
```

---